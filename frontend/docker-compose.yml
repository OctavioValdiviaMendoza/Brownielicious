version: "3.8"
services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          initial_sync: true
          ignore:
            - node_modules/
            - .next/
            - .git/
            - Dockerfile*
            - docker-compose*.yml
        # 2) If your package.json or package-lock.json changes, reinstall dependencies      
        - action: rebuild
          path: package.json
        - action: rebuild
          path: package-lock.json
        # 3) If your Dockerfile.dev changes, rebuild the image
        - action: rebuild
          path: Dockerfile.dev

    environment:
      # Use polling for file watchers on Windows/WSL/docker-for-windows
      - CHOKIDAR_USEPOLLING=true
    # Ensure Next dev is reachable externally
    command: ["npm", "run", "dev", "--", "-H", "0.0.0.0"]
